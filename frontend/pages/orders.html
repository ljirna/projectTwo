<div class="container mt-3">
  <br />
  <hr />
  <div>
    <table class="table table-striped table-bordered" id="order-details">
      <thead>
        <tr>
          <th>Details</th>
          <th>Order number</th>
          <th>Total amount</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<!-- Modal -->
<div
  class="modal fade"
  id="order-details-modal"
  tabindex="-1"
  aria-labelledby="order-details-label"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="order-details-label">Modal title</h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <table class="table">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Product name</th>
              <th scope="col">Quantity</th>
              <th scope="col">Single unit cost (BAM)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th scope="row">1</th>
              <td>Pasteta</td>
              <td>2</td>
              <td>3.20</td>
            </tr>
            <tr>
              <th scope="row">2</th>
              <td>Mlijeko</td>
              <td>1</td>
              <td>2.45</td>
            </tr>
            <tr>
              <th scope="row">3</th>
              <td>Supa</td>
              <td>4</td>
              <td>1.10</td>
            </tr>
            <tr>
              <td colspan="3"><strong>Total bill</strong></td>
              <td>12.25</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Close
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  /* 
    1. Populate the table with id `order-details` with the data returned 
       from the database. The table has to be fully paginated with search and order. (10 points)
    2. When Details button is clicked
      a. fetch the order details with clicked id from database (backend) (6 points)
      b. populate the modal (id `order-details-modal`) form with data returned from the backend (6 points)
   */
  $(document).ready(function () {
    RestClient.get("orders/report", function (data) {
      var totalAmount = 0;
      data.forEach((element) => {
        totalAmount += parseFloat(element.total_amount);
        var newRow = `
        <tr>
          <td class="text-center">
            <button
              type="button"
              class="btn btn-success"
              data-bs-toggle="modal"
              data-bs-target="#order-details-modal"
              data-bs-id="${element.order_number}"
            >
              Details
            </button>
          </td>
          <td>${element.order_number}</td>
          <td>${element.total_amount}</td>
        </tr>`;
        $("#order-details tbody").append(newRow);
      });

      var totalAmountColumn = `
          <tr>
            <td></td>
            <td>Total order amount</td>
            <td>${totalAmount}</td>
          </tr>`;
      $("#order-details tbody").append(totalAmountColumn);
    });
  });
</script>
